@app.route('/cart')
def cart():
    if 'user_id' not in session:
        return redirect(url_for('login'))
    try:
        user_id = session['user_id']
        cur = mysql.connection.cursor()
        cur.execute("""
            SELECT b.title, c.quantity, b.price, (c.quantity * b.price) AS subtotal
            FROM Cart c
            JOIN Book b ON c.book_id = b.book_id
            WHERE c.customer_id = %s
        """, (user_id,))
        cart_items = cur.fetchall()
        cur.close()

        total = sum(item[3] for item in cart_items)  # Calculate total price
        formatted_items = [
            {
                "title": item[0],
                "quantity": item[1],
                "price": item[2],
                "subtotal": item[3]
            }
            for item in cart_items
        ]

        return render_template('cart.html', cart_items=formatted_items, total=total)
    except Exception as e:
        print("Error:", e)
        return jsonify({"error": str(e)})
